<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h2>Student Dashboard</h2>
    <div class="profile-card">
        <p id="name"><b>Name:</b> Loading...</p>
        <p id="studentno"><b>Student No:</b> Loading...</p>
    </div>

    <h3>My Grades</h3>
    <ul id="grades" class="grade-list">
        <li>Loading grades...</li>
    </ul>

    <button onclick="logout()" style="background-color: #ef4444;">Logout</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
    const supabaseUrl = "https://nrlsgrzqpduzzzphkhtn.supabase.co";
    const supabaseKey = "YeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ybHNncnpxcGR1enp6cGhraHRuIiwicm9sZSI6ImFubm9uIiwiaWF0IjoxNzcwNjI2MDY0LCJleHAiOjIwODYyMDIwNjR9.oQj3f76HaEHtweWu7vKTr1Atc1XYFq8gffv9eIO78Mc";
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function loadDashboard() {
        const { data: { user } } = await _supabase.auth.getUser();
        if (!user) { window.location.href = "index.html"; return; }

        // Fetch Student Info
        const { data: student } = await _supabase.from("students").select("*").eq("user_id", user.id).single();
        if (student) {
            document.getElementById("name").innerText = "Name: " + student.name;
            document.getElementById("studentno").innerText = "Student No: " + student.student_no;
        }

        // Fetch Grades
        const { data: grades } = await _supabase.from("grades").select("grade, subjects(subject_name)").eq("user_id", user.id);
        const list = document.getElementById("grades");
        list.innerHTML = "";

        if (!grades || grades.length === 0) {
            list.innerHTML = "<li>No grades found</li>";
        } else {
            grades.forEach(g => {
                const li = document.createElement("li");
                li.innerText = `${g.subjects.subject_name}: ${g.grade}`;
                list.appendChild(li);
            });
        }
    }

    async function logout() {
        await _supabase.auth.signOut();
        window.location.href = "index.html";
    }

    loadDashboard();
</script>
</body>
</html>